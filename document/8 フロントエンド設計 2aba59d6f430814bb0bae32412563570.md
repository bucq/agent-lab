# 8. フロントエンド設計

フロントエンドのUI設計と主要コンポーネントの説明を記載します。

## UI構成 (MVP - Streamlit)

### レイアウト

```
┌─────────────────────────────────────────┐
│  🤖 現在のエージェント: Webスクレイパー    │ ← ヘッダー
├──────────┬────────────────────────────────┤
│          │                              │
│ エージェント │  チャット履歴                │
│ 一覧      │  ┌────────────────────┐    │
│          │  │ User: こんにちは    │    │
│ □ 汎用    │  └────────────────────┘    │
│   チャット │  ┌────────────────────┐    │
│          │  │ AI: こんにちは!     │    │
│ ☑ Web    │  │ 何をお手伝いしましょう│    │
│   スクレイパー│  └────────────────────┘    │
│          │                              │
│          │  ┌────────────────────┐    │
│          │  │ メッセージ入力...   │    │
│          │  └────────────────────┘    │
│          │        [送信]               │
└──────────┴────────────────────────────────┘
```

### 主要エリア

1. **ヘッダーエリア**
    - 現在選択中のエージェント名表示
    - アイコン表示
2. **サイドバー (左)**
    - エージェント一覧
    - 選択状態の表示
3. **メインエリア (右)**
    - チャット履歴
    - メッセージ入力フォーム
    - 送信ボタン

---

## 主要コンポーネント

### 1. [app.py](http://app.py) (メインアプリ)

**役割**

- アプリのエントリーポイント
- レイアウト構成
- ステート管理

**主要機能**

- Streamlit設定
- API Client初期化
- Session State管理
- レイアウトの構築

**Session State**

- `api_client`: APIクライアントインスタンス
- `session_id`: UUID v4
- `messages`: 会話履歴
- `current_agent`: 選択中エージェントID
- `agents`: エージェント一覧

---

### 2. agent_[selector.py](http://selector.py)

**役割**

- エージェント選択UIのレンダリング

**表示内容**

- エージェント名
- エージェント説明 (展開可能)
- MCP対応バッジ
- 選択状態インジケーター

**インタラクション**

- エージェントクリックで選択
- `st.session_state.current_agent` 更新
- 選択中のエージェントをハイライト

**UI要素**

- [`st.radio`](http://st.radio) または `st.button`
- エージェント情報の表示

---

### 3. chat_[interface.py](http://interface.py)

**役割**

- チャットUIのレンダリング
- メッセージの送受信

**主要機能**

1. **メッセージ履歴表示**
    - 過去のメッセージをループ表示
    - message_[display.py](http://display.py)を使用
2. **メッセージ入力**
    - [`st.chat](http://st.chat)_input` 使用
    - Enterキーで送信
3. **ストリーミング表示**
    - `st.write_stream` 使用
    - SSEイベントを逐次表示
4. **ツール実行表示**
    - ツール呼び出し中の表示
    - スピナーアニメーション

**フロー**

1. ユーザーがメッセージ入力
2. ユーザーメッセージを表示
3. APIにリクエスト送信
4. AIレスポンスをストリーミング表示
5. 履歴に追加

---

### 4. message_[display.py](http://display.py)

**役割**

- 個別メッセージのレンダリング

**表示パターン**

1. **ユーザーメッセージ**
    - 右寄せ
    - 青系の背景色
    - ユーザーアイコン
2. **AIメッセージ**
    - 左寄せ
    - グレー系の背景色
    - AIアイコン
3. **システムメッセージ**
    - 中央寄せ
    - 黄色系の背景色
    - ツール実行情報等

**使用UI要素**

- [`st.chat](http://st.chat)_message`
- `st.markdown`

---

### 5. api_[client.py](http://client.py)

**役割**

- バックエンドAPIとの通信

**主要メソッド**

1. **get_agents()**
    - GET `/api/agents`
    - エージェント一覧取得
2. **stream_chat()**
    - POST `/api/chat/stream`
    - SSEストリーミング受信
    - AsyncGeneratorでyield

**実装詳細**

- `httpx.AsyncClient` 使用
- SSEパース処理
- エラーハンドリング
- タイムアウト設定 (60秒)

---

## ストリーミング表示詳細

### 実装方法

**Streamlitの機能**

- `st.write_stream(generator)` 使用
- AsyncGeneratorを直接渡す

**表示フロー**

1. APIからSSEイベント受信
2. イベントタイプを判定
3. タイプに応じた処理
    - `message`: テキストを逐次表示
    - `tool_call`: スピナー表示
    - `tool_result`: 結果表示
    - `done`: 完了
    - `error`: エラーメッセージ

**パフォーマンス**

- チャンクごとに即座に表示
- 遅延 < 100ms

---

## Phase 2: React移行

### 主要変更点

**技術スタック**

- React 18+
- TypeScript
- Vite
- Material-UI / shadcn/ui

**コンポーネント構造**

```
src/
├── components/
│   ├── AgentSelector.tsx
│   ├── ChatInterface.tsx
│   ├── MessageDisplay.tsx
│   └── Header.tsx
├── services/
│   └── apiClient.ts
├── hooks/
│   ├── useAgents.ts
│   └── useChat.ts
├── App.tsx
└── main.tsx
```

**追加機能**

- ダークモード
- レスポンシブデザイン
- アニメーション
- キーボードショートカット

---

## アクセシビリティ

### 考慮事項

- キーボードナビゲーション
- ARIAラベル
- コントラスト比
- フォーカスインジケーター

### 対応ブラウザ

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)