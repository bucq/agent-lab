# 5. ディレクトリ構造

# ディレクトリ構造

プロジェクトのディレクトリ構造と各ファイルの役割を記載します。

## MVP ディレクトリ構成

```
agentic-chat-system/
├── frontend/                    # Streamlit アプリケーション
│   ├── [app.py](http://app.py)                  # メインエントリーポイント
│   ├── components/
│   │   ├── agent_[selector.py](http://selector.py)  # エージェント選択UI
│   │   ├── chat_[interface.py](http://interface.py)  # チャットUI
│   │   └── message_[display.py](http://display.py) # メッセージ表示
│   ├── services/
│   │   └── api_[client.py](http://client.py)      # バックエンドAPI通信
│   ├── requirements.txt
│   └── .streamlit/
│       └── config.toml         # Streamlit設定
│
├── backend/                     # FastAPI バックエンド
│   ├── [main.py](http://main.py)                 # FastAPIエントリーポイント
│   ├── api/
│   │   ├── routes/
│   │   │   └── [chat.py](http://chat.py)        # チャットエンドポイント
│   │   └── schemas/
│   │       └── [chat.py](http://chat.py)        # Pydanticスキーマ
│   ├── core/
│   │   ├── agents/
│   │   │   ├── [base.py](http://base.py)        # 抽象基底クラス
│   │   │   ├── openai_[agent.py](http://agent.py)
│   │   │   └── default_[agent.py](http://agent.py)
│   │   ├── mcp/
│   │   │   ├── [client.py](http://client.py)      # MCP Client
│   │   │   └── servers.json   # MCP Server設定
│   │   └── [factory.py](http://factory.py)         # Agent Factory
│   ├── models/
│   │   └── [session.py](http://session.py)         # セッション管理(メモリ)
│   ├── [config.py](http://config.py)               # 設定・環境変数
│   ├── requirements.txt
│   └── tests/
│
├── docker-compose.yml          # ローカル開発環境
├── .env.example                # 環境変数テンプレート
└── [README.md](http://README.md)                   # セットアップ手順
```

---

## ファイル説明

### Frontend

[**app.py**](http://app.py)

- Streamlitアプリのエントリーポイント
- レイアウト構成
- ステート管理

**components/agent_[selector.py](http://selector.py)**

- エージェント一覧の表示
- エージェント選択機能
- 選択状態の管理

**components/chat_[interface.py](http://interface.py)**

- メッセージ履歴の表示
- メッセージ入力フォーム
- ストリーミング表示処理

**components/message_[display.py](http://display.py)**

- 個別メッセージのレンダリング
- ユーザー/AIメッセージの分別

**services/api_[client.py](http://client.py)**

- FastAPIへのリクエスト
- SSEストリーミング受信
- エラーハンドリング

**requirements.txt**

```
streamlit==1.31.0
httpx==0.26.0
```

**.streamlit/config.toml**

- Streamlitの設定ファイル
- テーマ設定
- ポート設定

---

### Backend

[**main.py**](http://main.py)

- FastAPIアプリケーションの初期化
- CORS設定
- ルーターの登録

**api/routes/[chat.py](http://chat.py)**

- `/api/agents` エンドポイント
- `/api/chat/stream` エンドポイント
- リクエストハンドラー

**api/schemas/[chat.py](http://chat.py)**

- リクエスト/レスポンスのPydanticモデル
- バリデーションルール

**core/agents/[base.py](http://base.py)**

- BaseAgent 抽象基底クラス
- 共通インターフェース定義
- `stream_chat()`, `get_agent_info()`, `supports_mcp()`

**core/agents/openai_[agent.py](http://agent.py)**

- OpenAI SDKを使用したエージェント実装
- MCPツール統合
- ストリーミング処理

**core/agents/default_[agent.py](http://agent.py)**

- シンプルなチャットエージェント
- MCPなし

**core/mcp/[client.py](http://client.py)**

- MCPサーバーへの接続管理
- ツール一覧取得
- ツール実行

**core/mcp/servers.json**

```json
{
  "mcp-server-fetch": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-fetch"],
    "env": {}
  }
}
```

**core/[factory.py](http://factory.py)**

- Agent Factoryクラス
- エージェントの登録・管理
- エージェントID→インスタンスマッピング

**models/[session.py](http://session.py)**

- Sessionクラス
- インメモリセッション管理
- 会話履歴保持

[**config.py**](http://config.py)

- 環境変数読み込み
- 各種設定値

**requirements.txt**

```
fastapi==0.109.0
uvicorn[standard]==0.27.0
openai==1.10.0
httpx==0.26.0
python-dotenv==1.0.0
mcp==0.1.0
pydantic==2.5.0
```

---

## Phase 2 追加構成

```
├── frontend-react/             # React アプリケーション
│   ├── src/
│   │   ├── components/
│   │   ├── services/
│   │   └── App.tsx
│   └── package.json
│
├── backend/
│   ├── core/
│   │   ├── agents/
│   │   │   ├── aws_[agent.py](http://agent.py)   # AWS SDK実装
│   │   │   └── bedrock_[agent.py](http://agent.py)
│   │   └── storage/
│   │       └── s3_[client.py](http://client.py)
│   ├── db/
│   │   ├── [models.py](http://models.py)          # SQLAlchemy Models
│   │   └── [session.py](http://session.py)
│   └── alembic/               # DBマイグレーション
│
└── infrastructure/             # IaC (Terraform/CloudFormation)
    ├── lambda/
    ├── rds/
    └── s3/
```

---

## 重要な設定ファイル

### docker-compose.yml

```yaml
version: '3.8'

services:
  backend:
    build:
      context: ./backend
    ports:
      - "8000:8000"
    environment:
      - LM_STUDIO_URL=[http://host.docker.internal:1234/v1](http://host.docker.internal:1234/v1)
    volumes:
      - ./backend:/app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build:
      context: ./frontend
    ports:
      - "8501:8501"
    environment:
      - BACKEND_URL=[http://backend:8000](http://backend:8000)
    volumes:
      - ./frontend:/app
    depends_on:
      - backend
    command: streamlit run [app.py](http://app.py) --server.port 8501
```

### .env.example

```bash
# LLM Provider
LLM_PROVIDER=lmstudio
LM_STUDIO_URL=[http://localhost:1234/v1](http://localhost:1234/v1)
LM_STUDIO_MODEL=qwen2.5-coder-7b-instruct

# OpenAI API (Optional)
OPENAI_API_KEY=sk-...

# Backend
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000

# Frontend
FRONTEND_HOST=0.0.0.0
FRONTEND_PORT=8501

# MCP Servers
MCP_SERVER_FETCH_PATH=/path/to/mcp-server-fetch
```

---

## ファイル作成順序

### フェーズ1: 基本構造

1. プロジェクトルートディレクトリ作成
2. frontend/backend ディレクトリ作成
3. requirements.txt 作成
4. docker-compose.yml 作成
5. .env.example 作成

### フェーズ2: バックエンド

1. backend/core/agents/[base.py](http://base.py)
2. backend/core/agents/default_[agent.py](http://agent.py)
3. backend/api/schemas/[chat.py](http://chat.py)
4. backend/api/routes/[chat.py](http://chat.py)
5. backend/[main.py](http://main.py)
6. backend/[config.py](http://config.py)
7. backend/models/[session.py](http://session.py)

### フェーズ3: MCP統合

1. backend/core/mcp/servers.json
2. backend/core/mcp/[client.py](http://client.py)
3. backend/core/agents/openai_[agent.py](http://agent.py)
4. backend/core/[factory.py](http://factory.py)

### フェーズ4: フロントエンド

1. frontend/services/api_[client.py](http://client.py)
2. frontend/components/message_[display.py](http://display.py)
3. frontend/components/agent_[selector.py](http://selector.py)
4. frontend/components/chat_[interface.py](http://interface.py)
5. frontend/[app.py](http://app.py)
6. frontend/.streamlit/config.toml